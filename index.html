<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nutrition Requirement Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-800 min-h-screen flex items-center justify-center p-6">
  <div class="bg-white rounded-2xl shadow-lg w-full max-w-2xl p-8">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">
      Nutrition Requirement Calculator
    </h1>

    <!-- Input Form -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="font-semibold block mb-1">Sex</label>
        <select id="sex" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>

      <div>
        <label class="font-semibold block mb-1">Height (cm)</label>
        <input id="height" type="number" step="0.1" placeholder="Enter height in cm"
               class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>

      <div>
        <label class="font-semibold block mb-1">Weight (kg)</label>
        <input id="weight" type="number" step="0.1" placeholder="Enter weight in kg"
               class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
      </div>

      <div>
        <label class="font-semibold block mb-1">Milk Formula</label>
        <select id="milk" class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
          <option value="Glucerna">Glucerna</option>
          <option value="Nutrien Optimum">Nutrien Optimum</option>
          <option value="Novasource Renal">Novasource Renal</option>
          <option value="Ensure">Ensure</option>
          <option value="Enercal">Enercal</option>
          <option value="Nephro">Nephro</option>
          <option value="Peptamen">Peptamen</option>
          <option value="Myotein">Myotein</option>
        </select>
      </div>
    </div>

    <button onclick="calculate()"
      class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg transition">
      Calculate
    </button>

    <!-- Results -->
    <div id="result" class="mt-8 hidden bg-gray-50 border border-gray-200 rounded-xl p-6"></div>

    <!-- ASPEN Citation -->
    <div class="mt-6 text-center text-sm text-gray-500 border-t pt-4">
      <p>
        <strong>Note:</strong> Kilocalorie and protein requirements are based on
        recommendations from the 
        <em>American Society for Parenteral and Enteral Nutrition (ASPEN)</em> Clinical Guidelines.
      </p>
      <p class="mt-2 italic text-gray-400">
        Source: Compher C, Bingham AL, McCall M, et al. 
        <br>
        <span class="block">
          <em>Guidelines for the Provision of Nutrition Support Therapy in the Adult Critically Ill Patient:</em> 
          ASPEN. <a href="https://aspenjournals.onlinelibrary.wiley.com/doi/10.1002/jpen.2039" 
          target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
          JPEN J Parenter Enteral Nutr. 2021;45(5):875â€“894.</a>
        </span>
      </p>
    </div>
  </div>

  <script>
    const milkOptions = {
      "Glucerna": { kcal: 45, protein: 2, unit: "scoop" },
      "Nutrien Optimum": { kcal: 36, protein: 1.2, unit: "scoop" },
      "Novasource Renal": { kcal: 474, protein: 24.57, unit: "bottle", volume: 237 },
      "Ensure": { kcal: 43, protein: 1.3, unit: "scoop" },
      "Enercal": { kcal: 40, protein: 1.2, unit: "scoop" },
      "Nephro": { kcal: 396, protein: 17.6, unit: "bottle", volume: 220 },
      "Peptamen": { kcal: 25, protein: 0, unit: "scoop" },
      "Myotein": { kcal: 22, protein: 5, unit: "scoop" }
    };

    function calculate() {
      const sex = document.getElementById("sex").value;
      const height = parseFloat(document.getElementById("height").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const milkChoice = document.getElementById("milk").value;

      if (!height || !weight) {
        alert("Please enter valid height and weight.");
        return;
      }

      const heightM = height / 100;
      const heightIn = height / 2.54;
      const bmi = weight / (heightM ** 2);

      // Ideal Body Weight (IBW)
      let ibw;
      if (sex === "male") ibw = 50 + 2.3 * (heightIn - 60);
      else ibw = 45.5 + 2.3 * (heightIn - 60);

      // Calorie Requirement (ASPEN 2021)
      let kcal;
      let usedIBW = false;
      if (bmi < 30) kcal = weight * 25;
      else if (bmi <= 50) kcal = weight * 14;
      else {
        kcal = ibw * 25;
        usedIBW = true;
      }

      // Protein Requirement (ASPEN 2021)
      let protein;
      if (bmi < 30) protein = weight * 2;
      else if (bmi < 40) protein = ibw * 2;
      else protein = ibw * 2.5;

      const milk = milkOptions[milkChoice];
      const perUnitKcal = milk.kcal;

      const feedsPerDay = 7;
      const totalUnits = kcal / perUnitKcal;
      const perFeedUnits = totalUnits / feedsPerDay;

      // Volume calculation for bottle-based formulas
      let volumeText = "";
      if (milkChoice === "Novasource Renal" || milkChoice === "Nephro") {
        const totalMl = totalUnits * milk.volume;
        const perFeedMl = totalMl / feedsPerDay;
        volumeText = `
          <p><strong>Total Volume (24 hrs):</strong> ${totalMl.toFixed(0)} mL</p>
          <p><strong>Per Feed (${feedsPerDay} feeds/24 hrs):</strong> ${perFeedMl.toFixed(0)} mL</p>
        `;
      }

      const kcalFeed = perFeedUnits * milk.kcal;
      const proteinFeed = perFeedUnits * milk.protein;

      const result = document.getElementById("result");
      result.classList.remove("hidden");

      const ibwText = usedIBW
        ? `<span class="text-amber-600 text-sm">(IBW used)</span>`
        : `<span class="text-green-600 text-sm">(Actual weight used)</span>`;

      result.innerHTML = `
        <h2 class="text-xl font-bold text-blue-700 mb-4">Results</h2>
        <p><strong>BMI:</strong> <span class="text-blue-700 font-semibold">${bmi.toFixed(2)}</span></p>
        <p><strong>Ideal Body Weight:</strong> <span class="text-blue-700 font-semibold">${ibw.toFixed(2)} kg</span></p>
        <p><strong>Daily Kilocalorie Requirement:</strong> 
          <span class="text-blue-700 font-semibold">${kcal.toFixed(2)} kcal</span> ${ibwText}</p>
        <p><strong>Daily Protein Requirement:</strong> 
          <span class="text-blue-700 font-semibold">${protein.toFixed(2)} g</span></p>
        <hr class="my-4">
        <p><strong>Selected Formula:</strong> ${milkChoice}</p>
        <p>Each ${milk.unit} provides ${milk.kcal} kcal and ${milk.protein} g protein.</p>
        <p><strong>Total (24 hrs):</strong> ${totalUnits.toFixed(1)} ${milk.unit}(s)</p>
        <p><strong>Per Feed (${feedsPerDay} feeds/24 hrs):</strong> 
          <span class="text-red-600 font-bold text-lg">${perFeedUnits.toFixed(2)} ${milk.unit}(s)</span> per feed</p>
        ${volumeText}
        <p>Each feed provides approximately 
          <span class="font-semibold text-blue-700">${kcalFeed.toFixed(0)} kcal</span> and 
          <span class="font-semibold text-blue-700">${proteinFeed.toFixed(1)} g</span> protein.
        </p>
      `;
    }
  </script>
</body>
</html>
